<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/main.css" />

    <title>Event Time</title>
</head>

<body class="login-signup-page">
    <div class="login-container subscribe-container">
        <h1>Tell us what you're interested in.</h1>

        <form action="index.html" id="subscribe-form">
            <div class="categories-container" id="categories">
                <!-- <div>
                    <input type="checkbox" id="c1" /><label for="c1"><img src="images/mountains.jpeg" alt="" /><span>Web
                            development</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c2" /><label for="c2"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c3" /><label for="c3"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c4" /><label for="c4"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c5" /><label for="c5"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c6" /><label for="c6"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c7" /><label for="c7"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div>
                <div>
                    <input type="checkbox" id="c8" /><label for="c8"><img src="images/mountains.jpeg"
                            alt="" /><span>CSS</span></label>
                </div> -->

                <script>
                    let categoriesContainer = document.getElementById("categories");

                    fetch("http://localhost:3000/auth/me", {
                            method: "GET",
                            headers: {
                                'Authorization': 'Bearer ' + sessionStorage.getItem('token')
                            }
                        })
                        .then(resp => resp.json())
                        .then(myJson2 => {
                            if (myJson2) {
                                console.log(myJson2.data.id);
                                fetch("http://localhost:3000/categories/unsubscribed?id=" + myJson2.data.id, {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        }
                                    })
                                    .then(function (response) {
                                        return response.json();
                                    })
                                    .then(function (myJson) {
                                        let categories = myJson.data.categories;
                                        let i = 0;
                                        categories.forEach(category => {
                                            let div = document.createElement("div");
                                            let input = document.createElement("input");
                                            input.type = "checkbox";
                                            input.id = category._id;
                                            input.name = "category";

                                            let label = document.createElement("label");
                                            label.htmlFor = category._id;

                                            let img = document.createElement("img");
                                            img.src = "images/mountains.jpeg";
                                            img.alt = " ";

                                            let span = document.createElement("span");
                                            span.innerText = category.name;

                                            label.appendChild(img);
                                            label.appendChild(span);
                                            div.appendChild(input);
                                            div.appendChild(label);

                                            categoriesContainer.appendChild(div);

                                            i++;
                                        });
                                    })
                                    .catch(err => {
                                        console.log(err);
                                    });
                            } else {
                                window.location.href = "index.html";
                            }
                        })
                        .catch(err => {
                            console.log(err);
                        })
                </script>

            </div>

            <input type="submit" id="subscribe-button" value="Subscribe" />
        </form>
    </div>
    <script src="scripts/subscribe.js"></script>

</body>

</html>